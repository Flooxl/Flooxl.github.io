// ====================
// –£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ñ–ò–ú–ê–ú–ò
// ====================
function switchMode(mode) {
    document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active'); // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –ª—É—á—à–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å event

    document.getElementById('game-absurd').classList.add('hidden');
    document.getElementById('game-danger').classList.add('hidden');
    document.getElementById(`game-${mode}`).classList.remove('hidden');

    if(mode === 'danger') {
        startChatScenario(0); 
    }
}

// ====================
// –†–ï–ñ–ò–ú 1: –ü–†–û–¢–û–ö–û–õ –ê–ë–°–£–†–î (–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä)
// ====================

// 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
const targetSum = Math.floor(Math.random() * 11) + 20; // –ß–∏—Å–ª–æ –æ—Ç 20 –¥–æ 30
const forbiddenWords = ['ADMIN', 'ROOT', 'SECRET', 'LOGIN', 'MASTER', 'SYSTEM'];
const targetWord = forbiddenWords[Math.floor(Math.random() * forbiddenWords.length)];
const emojis = ['üî•', 'üöÄ', 'üíÄ', 'üóø', 'üíº', 'üëÅÔ∏è', 'üß¨', 'ü¶†'];
const targetEmoji = emojis[Math.floor(Math.random() * emojis.length)];

// –°–ø–∏—Å–æ–∫ –∂–∏–≤–æ—Ç–Ω—ã—Ö (–≤–∫–ª—é—á–∞—è —Å–∏–º–≤–æ–ª—ã –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞)
const animalsRegex = /–ö–æ—Ç|–ü–µ—Å|–•–æ–º—è–∫|–ë–∞—Ä—ã—Å|–ë–µ—Ä–∫—É—Ç|–í–µ—Ä–±–ª—é–¥|–¢—É–ª–ø–∞—Ä/i;
const animalsText = "'–ö–æ—Ç', '–ü–µ—Å', '–•–æ–º—è–∫', '–ë–∞—Ä—ã—Å', '–ë–µ—Ä–∫—É—Ç' –∏–ª–∏ '–í–µ—Ä–±–ª—é–¥'";

// –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª
const rules = [
    { id: 1, text: "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤.", check: (p) => p.length >= 5 },
    { id: 2, text: "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ü–∏—Ñ—Ä—É.", check: (p) => /\d/.test(p) },
    { id: 3, text: "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–≥–ª–∞–≤–Ω—É—é –±—É–∫–≤—É.", check: (p) => /[A-Z]/.test(p) },
    { id: 4, text: "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª (!@#$%).", check: (p) => /[!@#$%^&*]/.test(p) },
    { id: 5, text: `–°—É–º–º–∞ —Ü–∏—Ñ—Ä –≤ –ø–∞—Ä–æ–ª–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–∞–≤–Ω–∞ ${targetSum}.`, check: (p) => {
        const nums = p.match(/\d/g);
        if (!nums) return false;
        return nums.reduce((a, b) => parseInt(a) + parseInt(b), 0) === targetSum;
    }},
    { id: 6, text: `–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ª–æ–≤–æ '${targetWord}' (—Ä–µ–≥–∏—Å—Ç—Ä –Ω–µ –≤–∞–∂–µ–Ω).`, check: (p) => new RegExp(targetWord, 'i').test(p) },
    { id: 7, text: "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º (—Å –±–æ–ª—å—à–æ–π –±—É–∫–≤—ã).", check: (p) => {
        const month = new Date().toLocaleString('ru', { month: 'long' });
        // –£–±–∏—Ä–∞–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏–µ –¥–ª—è –ø–∞–¥–µ–∂–µ–π (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π) –∏–ª–∏ –±–µ—Ä–µ–º –∫–æ—Ä–µ–Ω—å, –Ω–æ –ø—Ä–æ—â–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ç–æ—á–Ω–æ–µ
        // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Ç—Ä–µ–±—É–µ–º –∏–º–µ–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂, –∫–∞–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç toLocaleString (–æ–±—ã—á–Ω–æ)
        // –ù–æ –ª—É—á—à–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ö–æ–∂–¥–µ–Ω–∏—è
        const monthCap = month.charAt(0).toUpperCase() + month.slice(1);
        return p.includes(monthCap);
    }},
    { id: 8, text: "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å —Ä–∏–º—Å–∫—É—é —Ü–∏—Ñ—Ä—É V (–±—É–∫–≤–æ–π).", check: (p) => p.includes('V') },
    { id: 9, text: "–ü–∞—Ä–æ–ª—å –ù–ï –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª–æ–≤.", check: (p) => !/\s/.test(p) },
    { id: 10, text: `–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —ç–º–æ–¥–∑–∏: ${targetEmoji}`, check: (p) => p.includes(targetEmoji) },
    { id: 11, text: "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏—è 100 - 13.", check: (p) => p.includes('87') },
    { id: 12, text: `–í –ø–∞—Ä–æ–ª–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ: ${animalsText}.`, check: (p) => animalsRegex.test(p) },
    { id: 13, text: "–î–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–µ—Ç–Ω—ã–º —á–∏—Å–ª–æ–º.", check: (p) => p.length % 2 === 0 },
    { id: 14, text: "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω '.kz'", check: (p) => p.includes('.kz') },
    { id: 15, text: "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –±—É–∫–≤—É '—ë' –∏–ª–∏ '–Å'.", check: (p) => /—ë|–Å/.test(p) },
    { id: 16, text: "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–∫—É—â—É—é –º–∏–Ω—É—Ç—É (–¥–≤–µ —Ü–∏—Ñ—Ä—ã, —Å–µ–π—á–∞—Å: " + new Date().getMinutes().toString().padStart(2, '0') + ").", check: (p) => {
        const min = new Date().getMinutes().toString().padStart(2, '0');
        return p.includes(min);
    }}
];

const input = document.getElementById('passwordInput');
const rulesList = document.getElementById('rulesList');
const charCount = document.getElementById('charCount');

let activeRuleIndex = 0; 

function renderRules() {
    const password = input.value;
    charCount.textContent = password.length;
    rulesList.innerHTML = '';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç 16-–≥–æ –ø—Ä–∞–≤–∏–ª–∞
    const currentMin = new Date().getMinutes().toString().padStart(2, '0');
    rules[15].text = `–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ–∫—É—â—É—é –º–∏–Ω—É—Ç—É (–¥–≤–µ —Ü–∏—Ñ—Ä—ã, —Å–µ–π—á–∞—Å: ${currentMin}).`;

    let allActivePassed = true;

    for (let i = 0; i <= activeRuleIndex; i++) {
        if (i >= rules.length) break;
        
        const rule = rules[i];
        const passed = rule.check(password);
        
        if (!passed) allActivePassed = false;

        const div = document.createElement('div');
        div.className = `rule-card ${passed ? 'passed' : 'failed'}`;
        div.innerHTML = `
            <div class="rule-header">
                <span>–ü—Ä–∞–≤–∏–ª–æ ${rule.id}</span>
                <span>${passed ? '‚úÖ' : '‚ùå'}</span>
            </div>
            <div>${rule.text}</div>
        `;
        rulesList.prepend(div);
    }

    if (allActivePassed && activeRuleIndex < rules.length - 1) {
        activeRuleIndex++;
        setTimeout(renderRules, 200);
    } 
    // –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–π–¥–µ–Ω—ã (–ü–û–ë–ï–î–ê)
    else if (allActivePassed && activeRuleIndex === rules.length - 1) {
         // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç –ø–æ–±–µ–¥—ã –∑–¥–µ—Å—å
    }
}

input.addEventListener('input', renderRules);
setInterval(renderRules, 60000); // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω—É—Ç—ã

// ====================
// –†–ï–ñ–ò–ú 2: –û–ü–ê–°–ù–´–ï –°–í–Ø–ó–ò (10 –£—Ä–æ–≤–Ω–µ–π)
// ====================

const chatWindow = document.getElementById('chatWindow');
const choiceArea = document.getElementById('choiceArea');
const contactName = document.getElementById('chatContactName');

// –°—Ü–µ–Ω–∞—Ä–∏–∏: –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è, –í–∏—à–∏–Ω–≥, –§–∏—à–∏–Ω–≥
const scenarios = [
    // –£–†–û–í–ï–ù–¨ 1: –ì–æ–ª–æ—Å (–ë–∏–æ–º–µ—Ç—Ä–∏—è)
    {
        id: 0,
        sender: "–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ (Unknown)",
        messages: ["–ê–ª–ª–æ? –≠—Ç–æ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞.", "–ú—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—á–µ—Å—Ç–≤–æ —Å–≤—è–∑–∏.", "–í—ã –º–µ–Ω—è —Ö–æ—Ä–æ—à–æ —Å–ª—ã—à–∏—Ç–µ?"],
        options: [
            { text: "–î–∞, —Å–ª—ã—à—É.", correct: false, reason: "–û—à–∏–±–∫–∞! –í—ã —Å–∫–∞–∑–∞–ª–∏ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ '–î–∞'. –í–∞—à –≥–æ–ª–æ—Å –∑–∞–ø–∏—Å–∞–Ω –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ –±–∏–æ–º–µ—Ç—Ä–∏–∏." },
            { text: "–°–≤—è–∑—å –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è.", correct: true, next: 1 },
            { text: "–ö—Ç–æ —ç—Ç–æ? –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ—Å—å –ø–æ–ª–Ω–æ—Å—Ç—å—é.", correct: true, next: 1 }
        ]
    },
    // –£–†–û–í–ï–ù–¨ 2: –°—Ä–æ—á–Ω–æ—Å—Ç—å (CEO)
    {
        id: 1,
        sender: "–ì–µ–Ω. –î–∏—Ä–µ–∫—Ç–æ—Ä (–ê—Å–∫–∞—Ä)",
        messages: ["–°—Ä–æ—á–Ω–æ! –Ø –Ω–∞ –≤—Å—Ç—Ä–µ—á–µ –≤ –ê—Å—Ç–∞–Ω–µ.", "–ù–µ –º–æ–≥—É –≤–æ–π—Ç–∏ –≤ –æ–±–ª–∞–∫–æ, –ø–∞—Ä–æ–ª—å –≤—ã–ª–µ—Ç–µ–ª.", "–°–∫–∏–Ω—å –º–Ω–µ —Å–≤–æ–π –¥–æ—Å—Ç—É–ø, —è –±—ã—Å—Ç—Ä–æ –¥–æ–∫—É–º–µ–Ω—Ç –∑–∞–±–µ—Ä—É –∏ –≤—ã–π–¥—É.", "–í—Ä–µ–º–µ–Ω–∏ –Ω–µ—Ç –æ–±—ä—è—Å–Ω—è—Ç—å!"],
        options: [
            { text: "–í–æ—Ç –ø–∞—Ä–æ–ª—å: Qwerty12345", correct: false, reason: "–í—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–¥–∞–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Å–µ—Ç–∏. –î–∏—Ä–µ–∫—Ç–æ—Ä –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–ø—Ä–æ—Å–∏—Ç –≤–∞—à –ª–∏—á–Ω—ã–π –ø–∞—Ä–æ–ª—å." },
            { text: "–ê—Å–∫–∞—Ä, —è –Ω–µ –º–æ–≥—É –ø–µ—Ä–µ–¥–∞—Ç—å –ø–∞—Ä–æ–ª—å –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ. –≠—Ç–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏.", correct: true, next: 2 },
            { text: "–ü–æ–∑–≤–æ–Ω–∏—Ç–µ –≤ IT –æ—Ç–¥–µ–ª, –æ–Ω–∏ —Å–±—Ä–æ—Å—è—Ç –≤–∞–º –¥–æ—Å—Ç—É–ø.", correct: true, next: 2 }
        ]
    },
    // –£–†–û–í–ï–ù–¨ 3: –§–∞–π–ª (HR)
    {
        id: 2,
        sender: "HR –û—Ç–¥–µ–ª",
        messages: ["–ö–æ–ª–ª–µ–≥–∏, –¥–æ–±—Ä—ã–π –¥–µ–Ω—å!", "–í —á–µ—Å—Ç—å –ù–∞—É—Ä—ã–∑–∞ –∫–æ–º–ø–∞–Ω–∏—è –Ω–∞—á–∏—Å–ª—è–µ—Ç –ø—Ä–µ–º–∏–∏.", "–°–ø–∏—Å–æ–∫ —Å—É–º–º –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ.", "–°–∫–∞—á–∞—Ç—å: 'Premia_2025.exe'"],
        options: [
            { text: "–û, –∫—Ä—É—Ç–æ! –°–∫–∞—á–∏–≤–∞—é.", correct: false, reason: "–í—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª (.exe) –∏–∑ —á–∞—Ç–∞. –¢–µ–ø–µ—Ä—å –≤—Å—è —Å–µ—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∞ –≤–∏—Ä—É—Å–æ–º-–≤—ã–º–æ–≥–∞—Ç–µ–ª–µ–º." },
            { text: "–°—Ç—Ä–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –£—Ç–æ—á–Ω—é —É HR –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.", correct: true, next: 3 }
        ]
    },
    // –£–†–û–í–ï–ù–¨ 4: –ë–∞–Ω–∫ (–ö–æ–¥ –∏–∑ –°–ú–°)
    {
        id: 3,
        sender: "–°–ª—É–∂–±–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ë–∞–Ω–∫–∞",
        messages: ["–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ.", "–° –≤–∞—à–µ–π –∫–∞—Ä—Ç—ã –ø—ã—Ç–∞—é—Ç—Å—è —Å–æ–≤–µ—Ä—à–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ –≤ –ö–∞—Ä–∞–≥–∞–Ω–¥–µ –Ω–∞ 500 000 —Ç–µ–Ω–≥–µ.", "–ß—Ç–æ–±—ã –æ—Ç–º–µ–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é, –Ω–∞–∑–æ–≤–∏—Ç–µ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–µ–π—á–∞—Å –ø—Ä–∏–¥–µ—Ç –≤ –°–ú–°."],
        options: [
            { text: "–°–µ–π—á–∞—Å –ø–æ—Å–º–æ—Ç—Ä—é... 4589", correct: false, reason: "–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–∏–∫—Ç—É–π—Ç–µ –∫–æ–¥—ã –∏–∑ –°–ú–°! –í—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥ –º–æ—à–µ–Ω–Ω–∏–∫–∞–º." },
            { text: "–Ø —Å–∞–º –ø–µ—Ä–µ–∑–≤–æ–Ω—é –≤ –±–∞–Ω–∫ –ø–æ –Ω–æ–º–µ—Ä—É –Ω–∞ –∫–∞—Ä—Ç–µ.", correct: true, next: 4 },
            { text: "–ü—Ä–æ–¥–∏–∫—Ç—É–π—Ç–µ –Ω–æ–º–µ—Ä –≤–∞—à–µ–π –ª–∏—Ü–µ–Ω–∑–∏–∏.", correct: true, next: 4 }
        ]
    },
    // –£–†–û–í–ï–ù–¨ 5: –î–∏–ø—Ñ–µ–π–∫ (–ì–æ–ª–æ—Å–æ–≤–æ–µ)
    {
        id: 4,
        sender: "–ö–æ–ª–ª–µ–≥–∞ (–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è)",
        messages: ["(–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ): '–ü—Ä–∏–≤–µ—Ç! –°–ª—É—à–∞–π, —è —Ç—É—Ç –≤ –±–∞–Ω–∫–µ, –∫–∞—Ä—Ç—É –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏, –∑–∞–∫–∏–Ω—å –º–Ω–µ 20–∫ –Ω–∞ –ö–∞—Å–ø–∏, –∑–∞–≤—Ç—Ä–∞ –æ—Ç–¥–∞–º. –û—á–µ–Ω—å –Ω–∞–¥–æ!'", "–ù—É —á—Ç–æ, –≤—ã—Ä—É—á–∏—à—å?"],
        options: [
            { text: "–ö–æ–Ω–µ—á–Ω–æ, –¥–∏–∫—Ç—É–π –Ω–æ–º–µ—Ä.", correct: false, reason: "–≠—Ç–æ –¥–∏–ø—Ñ–µ–π–∫ (—Å–∏–Ω—Ç–µ–∑ –≥–æ–ª–æ—Å–∞). –ú–æ—à–µ–Ω–Ω–∏–∫–∏ –≤–∑—è–ª–∏ –≥–æ–ª–æ—Å –∫–æ–ª–ª–µ–≥–∏ –∏–∑ —Å–æ—Ü—Å–µ—Ç–µ–π. –í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–∑–≤–∞–Ω–∏–≤–∞–π—Ç–µ –ª–∏—á–Ω–æ." },
            { text: "–ü–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç—å –∫–æ–ª–ª–µ–≥–µ –ø–æ —Å–æ—Ç–æ–≤–æ–º—É.", correct: true, next: 5 },
            { text: "–ù–∞–ø–∏—Å–∞—Ç—å: '–ó–∞–π–¥–∏ –∫–æ –º–Ω–µ –≤ –∫–∞–±–∏–Ω–µ—Ç, –¥–∞–º –Ω–∞–ª–∏—á–∫–æ–π'.", correct: true, next: 5 }
        ]
    },
    // –£–†–û–í–ï–ù–¨ 6: –ì–æ—Å. –£—Å–ª—É–≥–∏ (E-gov)
    {
        id: 5,
        sender: "E-gov Notification",
        messages: ["–í–∞–∂–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.", "–í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω —à—Ç—Ä–∞—Ñ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ü–î–î.", "–û–ø–ª–∞—Ç–∏—Ç–µ —Å–æ —Å–∫–∏–¥–∫–æ–π 50% –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞ –ø–æ —Å—Å—ã–ª–∫–µ: egov-kz-penalty.online"],
        options: [
            { text: "–ü–µ—Ä–µ–π—Ç–∏ –∏ –æ–ø–ª–∞—Ç–∏—Ç—å", correct: false, reason: "–§–∏—à–∏–Ω–≥! –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –¥–æ–º–µ–Ω (egov-kz-penalty.online). –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç ‚Äî egov.kz." },
            { text: "–ó–∞–π—Ç–∏ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ E-gov –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å.", correct: true, next: 6 }
        ]
    },
    // –£–†–û–í–ï–ù–¨ 7: –ö—É—Ä—å–µ—Ä
    {
        id: 6,
        sender: "–ö—É—Ä—å–µ—Ä—Å–∫–∞—è —Å–ª—É–∂–±–∞",
        messages: ["–Ø –ø–æ–¥—ä–µ—Ö–∞–ª –∫ –æ—Ñ–∏—Å—É —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π.", "–û—Ö—Ä–∞–Ω–∞ –Ω–µ –ø—É—Å–∫–∞–µ—Ç.", "–°–∫–∏–Ω—å—Ç–µ —Ñ–æ—Ç–æ –≤–∞—à–µ–≥–æ –ø—Ä–æ–ø—É—Å–∫–∞ —Å –¥–≤—É—Ö —Å—Ç–æ—Ä–æ–Ω, —è –∏–º –ø–æ–∫–∞–∂—É, —á—Ç–æ –≤—ã –º–µ–Ω—è –∂–¥–µ—Ç–µ."],
        options: [
            { text: "–û–∫, —Å–µ–π—á–∞—Å —Å—Ñ–æ—Ç–∫–∞—é.", correct: false, reason: "–í—ã –ø–µ—Ä–µ–¥–∞–ª–∏ –º–æ—à–µ–Ω–Ω–∏–∫–∞–º –æ–±—Ä–∞–∑–µ—Ü –ø—Ä–æ–ø—É—Å–∫–∞. –ï–≥–æ –ø–æ–¥–¥–µ–ª–∞—é—Ç –∏ –ø—Ä–æ–Ω–∏–∫–Ω—É—Ç –≤ –æ—Ñ–∏—Å." },
            { text: "–Ø —Å–ø—É—â—É—Å—å —Å–∞–º.", correct: true, next: 7 },
            { text: "–°–∫–∞–∂–∏—Ç–µ –æ—Ö—Ä–∞–Ω–µ –ø–æ–∑–≤–æ–Ω–∏—Ç—å –º–Ω–µ –Ω–∞ —Ä–∞–±–æ—á–∏–π.", correct: true, next: 7 }
        ]
    },
    // –£–†–û–í–ï–ù–¨ 8: "–ù–∞—á–∞–ª—å—Å—Ç–≤–æ" (–°—Ö–µ–º–∞ Boss)
    {
        id: 7,
        sender: "–ö—É—Ä–∞—Ç–æ—Ä –∏–∑ –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–∞",
        messages: ["–î–æ–±—Ä—ã–π –¥–µ–Ω—å.", "–°–µ–π—á–∞—Å —Å –≤–∞–º–∏ —Å–≤—è–∂–µ—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –ö–ù–ë –ø–æ –≤–æ–ø—Ä–æ—Å—É —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö.", "–°–∏—Ç—É–∞—Ü–∏—è —Å–µ—Ä—å–µ–∑–Ω–∞—è. –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –≤—Å–µ –µ–≥–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.", "–í—ã –º–µ–Ω—è –ø–æ–Ω—è–ª–∏?"],
        options: [
            { text: "–ü–æ–Ω—è–ª, –∂–¥—É –∑–≤–æ–Ω–∫–∞.", correct: false, reason: "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Å—Ö–µ–º–∞. –°–Ω–∞—á–∞–ª–∞ –ø–∏—à–µ—Ç —è–∫–æ–±—ã '–Ω–∞—á–∞–ª—å–Ω–∏–∫', —á—Ç–æ–±—ã –ø–æ–¥–∞–≤–∏—Ç—å –≤–æ–ª—é, –ø–æ—Ç–æ–º –∑–≤–æ–Ω–∏—Ç '–æ—Ñ–∏—Ü–µ—Ä'. –≠—Ç–æ –º–æ—à–µ–Ω–Ω–∏–∫–∏." },
            { text: "–ü—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ–æ–±—â–∏—Ç—å –≤ —Å–ª—É–∂–±—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.", correct: true, next: 8 }
        ]
    },
    // –£–†–û–í–ï–ù–¨ 9: –û–ø—Ä–æ—Å
    {
        id: 8,
        sender: "–û–ø—Ä–æ—Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤",
        messages: ["–ü—Ä–æ—Ö–æ–¥–∏–º –µ–∂–µ–≥–æ–¥–Ω—ã–π –æ–ø—Ä–æ—Å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏.", "–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google-–∞–∫–∫–∞—É–Ω—Ç, —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ª–∏—á–Ω–æ—Å—Ç—å.", "–°—Å—ã–ª–∫–∞: forms-google.com.su/login"],
        options: [
            { text: "–í–≤–µ—Å—Ç–∏ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å.", correct: false, reason: "–§–∏—à–∏–Ω–≥–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞. –î–æ–º–µ–Ω .com.su ‚Äî —ç—Ç–æ –ø–æ–¥–¥–µ–ª–∫–∞." },
            { text: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥—Ä–µ—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É.", correct: true, next: 9 }
        ]
    },
    // –£–†–û–í–ï–ù–¨ 10: –§–∏–Ω–∞–ª
    {
        id: 9,
        sender: "SYSTEM",
        messages: ["–ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù.", "–í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ 10 —É—Ä–æ–≤–Ω–µ–π —É–≥—Ä–æ–∑.", "–í–∞—à–∞ –∫–∏–±–µ—Ä—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞."],
        options: [
            { text: "–ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –∑–∞–Ω–æ–≤–æ", correct: true, next: 0 }
        ]
    }
];

let currentScenarioIndex = 0;

function startChatScenario(index) {
    currentScenarioIndex = index;
    const scenario = scenarios[index];
    
    // –û—á–∏—Å—Ç–∫–∞
    chatWindow.innerHTML = '';
    choiceArea.innerHTML = '';
    contactName.innerText = scenario.sender;

    // –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
    let delay = 0;
    scenario.messages.forEach((msg, i) => {
        setTimeout(() => {
            addMessage(msg, 'bot');
            if (i === scenario.messages.length - 1) {
                showChoices(scenario.options);
            }
        }, delay);
        delay += 800 + Math.random() * 800; // –ù–µ–º–Ω–æ–≥–æ —É—Å–∫–æ—Ä–∏–ª
    });
}

function addMessage(text, type) {
    const msgDiv = document.createElement('div');
    msgDiv.className = `message ${type}`;
    msgDiv.innerText = text;
    chatWindow.appendChild(msgDiv);
    chatWindow.scrollTop = chatWindow.scrollHeight; 
}

function showChoices(options) {
    options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.innerText = opt.text;
        btn.onclick = () => handleChoice(opt);
        choiceArea.appendChild(btn);
    });
}

function handleChoice(option) {
    addMessage(option.text, 'user');
    choiceArea.innerHTML = ''; 

    setTimeout(() => {
        if (option.correct) {
            if (option.next !== undefined) {
                startChatScenario(option.next);
            }
        } else {
            // –û–®–ò–ë–ö–ê
            addMessage("‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê", 'bot');
            addMessage(option.reason, 'bot');
            
            const restartBtn = document.createElement('button');
            restartBtn.className = 'choice-btn';
            restartBtn.innerText = "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –∑–∞–Ω–æ–≤–æ";
            restartBtn.style.borderColor = "var(--red)";
            restartBtn.onclick = () => startChatScenario(currentScenarioIndex);
            choiceArea.appendChild(restartBtn);
        }
    }, 800);
}

// –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
renderRules();